<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>TETRIS — HD Mobile</title>
<style>
  :root{
    --bg:#0b0f1a; --panel:#111827; --panel-2:#0f172a; --text:#e6edf7; --muted:#9aa7bd;
    --accent:#6ee7ff; --accent-2:#36c6ea; --grid:#1f2a44;
    --good:#57d97a; --warn:#ffb84d; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{margin:0; background:radial-gradient(1200px 600px at 20% 0%, #0b0f1a 0%, #0c1325 60%, #0b0f1a 100%); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; height:100%}
  .app{min-height:100dvh; display:flex; flex-direction:column; gap:12px; padding:14px}
  .topbar{display:flex; align-items:center; justify-content:space-between; background:linear-gradient(180deg,#0e1627,#0d1424); border:1px solid #1b2542; border-radius:16px; padding:10px 12px; position:sticky; top:14px; z-index:10; box-shadow:0 10px 24px rgba(0,0,0,.35)}
  .brand{display:flex; align-items:center; gap:10px}
  .logo{width:28px; height:28px; border-radius:8px; background:radial-gradient(circle at 30% 30%, var(--accent) 0%, var(--accent-2) 55%, #2a6ab3 100%); box-shadow:0 0 16px rgba(110,231,255,.35), inset 0 0 8px rgba(255,255,255,.08); animation:pulse 3s infinite ease-in-out}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
  .title{font-weight:800; letter-spacing:.3px}
  .cta-row{display:flex; gap:8px; align-items:center}
  .btn{border:none; outline:none; padding:10px 14px; border-radius:12px; font-weight:700; color:#0b0f1a; background:var(--accent); box-shadow:0 6px 16px rgba(110,231,255,.25); transition:transform .08s ease, filter .2s ease, background .2s ease, box-shadow .2s ease; position:relative; overflow:hidden}
  .btn.secondary{background:#243152; color:var(--text); border:1px solid #33406d; box-shadow:none}
  .btn.good{background:var(--good)}
  .btn.warn{background:var(--warn)}
  .btn:active{transform:scale(.96); filter:saturate(1.2)}
  .btn::after{content:""; position:absolute; inset:0; background:radial-gradient(circle, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 60%); transform:scale(0); opacity:0; transition:transform .35s ease, opacity .35s ease}
  .btn:active::after{transform:scale(2.2); opacity:.35}

  .layout{display:grid; grid-template-columns: minmax(0,1fr) 280px; gap:12px}
  @media (max-width:720px){ .layout{grid-template-columns: 1fr} }

  .board-wrap{background:linear-gradient(180deg,#0e1627,#0c1423); border:1px solid #1b2542; border-radius:16px; padding:12px; box-shadow:0 10px 24px rgba(0,0,0,.35)}
  .board{width:100%; aspect-ratio:10/20; background:#0e1425; border-radius:12px; position:relative; overflow:hidden; border:10px solid transparent; background-clip:padding-box}
  .board::before{content:""; position:absolute; inset:0; background-image:
      linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
    background-size: calc(100%/10) 100%, 100% calc(100%/20); pointer-events:none}
  .ghost{position:absolute; border-radius:4px; background:rgba(255,255,255,.14); outline:1px dashed rgba(255,255,255,.25)}
  .cell{position:absolute; border-radius:4px; box-shadow:inset 0 0 6px rgba(255,255,255,.18), 0 2px 6px rgba(0,0,0,.45)}
  .banner{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(11,15,26,.0), rgba(11,15,26,.75)); opacity:0; pointer-events:none; transition:opacity .3s ease}
  .banner.show{opacity:1; pointer-events:auto}
  .banner-card{background:#0e1425; border:1px solid #202a48; border-radius:16px; padding:16px; text-align:center; box-shadow:0 8px 24px rgba(0,0,0,.35)}

  .side{background:linear-gradient(180deg,#0e1627,#0d1424); border:1px solid #1b2542; border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:10px; box-shadow:0 10px 24px rgba(0,0,0,.35)}
  .stat{display:flex; justify-content:space-between; align-items:center; background:#0d1324; border:1px solid #202a48; border-radius:12px; padding:8px 10px}
  .mini{height:110px; border-radius:12px; border:1px dashed #2c3a66; display:flex; align-items:center; justify-content:center; background:#0d1324; position:relative; overflow:hidden}

  .controls{display:grid; grid-template-columns: repeat(5, 1fr); gap:8px}
  .ctrl{border:none; outline:none; border-radius:12px; padding:12px 10px; font-weight:800; background:#253055; color:var(--text); border:1px solid #33406d; transition:transform .08s ease, background .2s ease, box-shadow .2s ease}
  .ctrl:active{transform:scale(.96); background:#2c3866; box-shadow:0 6px 16px rgba(0,0,0,.35)}

  .overlay{position:fixed; inset:0; display:flex; align-items:flex-end; justify-content:center; pointer-events:none}
  .sheet{width:100%; max-width:560px; background:var(--panel); border:1px solid #1e2744; border-top-left-radius:18px; border-top-right-radius:18px; transform:translateY(100%); opacity:0; transition:transform .35s cubic-bezier(.22,.61,.36,1), opacity .35s ease; pointer-events:auto; box-shadow:0 -16px 48px rgba(0,0,0,.35)}
  .sheet.open{transform:translateY(0); opacity:1}
  .sheet-head{padding:14px 16px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #1e2744}
  .sheet-body{padding:14px 16px; display:flex; flex-direction:column; gap:10px}
  .drag-indicator{width:44px; height:4px; border-radius:2px; background:#33406d; margin:6px auto 0}

  /* Tetromino colors */
  .c-I{background:#6ee7ff}
  .c-O{background:#ffd166}
  .c-T{background:#c3a6ff}
  .c-S{background:#57d97a}
  .c-Z{background:#ff6b6b}
  .c-J{background:#7aa3ff}
  .c-L{background:#ff9f6e}
</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">TETRIS HD</div>
    </div>
    <div class="cta-row">
      <button class="btn" id="ctaPlay">Main Sekarang</button>
      <button class="btn secondary" id="ctaMenu">Menu</button>
    </div>
  </div>

  <div class="layout">
    <div class="board-wrap">
      <div class="board" id="board" aria-label="Papan Tetris">
        <div class="banner" id="banner">
          <div class="banner-card">
            <div style="font-weight:800; font-size:18px; margin-bottom:8px;">Game Over</div>
            <div style="color:var(--muted); margin-bottom:12px;">Skor akhir: <span id="finalScore">0</span></div>
            <div style="display:flex; gap:8px; justify-content:center;">
              <button class="btn good" id="btnRestart">Mulai Lagi</button>
              <button class="btn secondary" id="btnCloseBanner">Tutup</button>
            </div>
          </div>
        </div>
      </div>
      <div class="controls" aria-label="Kontrol Sentuh">
        <button class="ctrl" id="btnLeft">A</button>
        <button class="ctrl" id="btnDown">S</button>
        <button class="ctrl" id="btnRight">D</button>
        <button class="ctrl" id="btnRotate">W</button>
        <button class="ctrl" id="btnHard">⤓</button>
      </div>
    </div>

    <div class="side">
      <div class="stat"><span>Skor</span><strong id="score">0</strong></div>
      <div class="stat"><span>Level</span><strong id="level">1</strong></div>
      <div class="stat"><span>Lines</span><strong id="lines">0</strong></div>
      <div class="stat"><span>Hold</span><strong id="holdName">—</strong></div>
      <div class="mini" id="holdWrap" aria-label="Hold piece"></div>
      <div class="stat"><span>Next</span><strong id="nextName">—</strong></div>
      <div class="mini" id="nextWrap" aria-label="Next piece"></div>
      <div style="display:flex; gap:8px;">
        <button class="btn good" id="btnStart">Mulai</button>
        <button class="btn warn" id="btnPause">Jeda</button>
      </div>
    </div>
  </div>
</div>

<!-- Bottom sheet menu -->
<div class="overlay" aria-hidden="true">
  <div class="sheet" id="sheet">
    <div class="sheet-head">
      <strong>Menu</strong>
      <button class="btn secondary" id="closeSheet">Tutup</button>
    </div>
    <div class="sheet-body">
      <div style="color:var(--muted);">Pilih tindakan di bawah ini.</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="sheetPlay">Main Sekarang</button>
        <button class="btn good" id="sheetStart">Mulai</button>
        <button class="btn warn" id="sheetPause">Jeda</button>
        <button class="btn secondary" id="sheetReset">Reset</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const COLS=10, ROWS=20;
  const boardEl = document.getElementById('board');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const linesEl = document.getElementById('lines');
  const finalScoreEl = document.getElementById('finalScore');
  const bannerEl = document.getElementById('banner');

  const holdWrap = document.getElementById('holdWrap');
  const nextWrap = document.getElementById('nextWrap');
  const holdName = document.getElementById('holdName');
  const nextName = document.getElementById('nextName');

  const btnLeft = document.getElementById('btnLeft');
  const btnRight = document.getElementById('btnRight');
  const btnDown = document.getElementById('btnDown');
  const btnRotate = document.getElementById('btnRotate');
  const btnHard = document.getElementById('btnHard');

  const btnStart = document.getElementById('btnStart');
  const btnPause = document.getElementById('btnPause');
  const btnRestart = document.getElementById('btnRestart');
  const btnCloseBanner = document.getElementById('btnCloseBanner');

  const ctaPlay = document.getElementById('ctaPlay');
  const ctaMenu = document.getElementById('ctaMenu');
  const sheet = document.getElementById('sheet');
  const closeSheet = document.getElementById('closeSheet');
  const sheetPlay = document.getElementById('sheetPlay');
  const sheetStart = document.getElementById('sheetStart');
  const sheetPause = document.getElementById('sheetPause');
  const sheetReset = document.getElementById('sheetReset');

  const COLORS = { I:'c-I', O:'c-O', T:'c-T', S:'c-S', Z:'c-Z', J:'c-J', L:'c-L' };
  const SHAPES = {
    I: [
      [[0,1],[1,1],[2,1],[3,1]],
      [[2,0],[2,1],[2,2],[2,3]],
      [[0,2],[1,2],[2,2],[3,2]],
      [[1,0],[1,1],[1,2],[1,3]]
    ],
    O: [
      [[1,0],[2,0],[1,1],[2,1]],
      [[1,0],[2,0],[1,1],[2,1]],
      [[1,0],[2,0],[1,1],[2,1]],
      [[1,0],[2,0],[1,1],[2,1]]
    ],
    T: [
      [[1,0],[0,1],[1,1],[2,1]],
      [[1,0],[1,1],[2,1],[1,2]],
      [[0,1],[1,1],[2,1],[1,2]],
      [[1,0],[0,1],[1,1],[1,2]]
    ],
    S: [
      [[1,0],[2,0],[0,1],[1,1]],
      [[1,0],[1,1],[2,1],[2,2]],
      [[1,1],[2,1],[0,2],[1,2]],
      [[0,0],[0,1],[1,1],[1,2]]
    ],
    Z: [
      [[0,0],[1,0],[1,1],[2,1]],
      [[2,0],[1,1],[2,1],[1,2]],
      [[0,1],[1,1],[1,2],[2,2]],
      [[1,0],[0,1],[1,1],[0,2]]
    ],
    J: [
      [[0,0],[0,1],[1,1],[2,1]],
      [[1,0],[2,0],[1,1],[1,2]],
      [[0,1],[1,1],[2,1],[2,2]],
      [[1,0],[1,1],[0,2],[1,2]]
    ],
    L: [
      [[2,0],[0,1],[1,1],[2,1]],
      [[1,0],[1,1],[1,2],[2,2]],
      [[0,1],[1,1],[2,1],[0,2]],
      [[0,0],[1,0],[1,1],[1,2]]
    ]
  };

  let grid = createGrid(COLS, ROWS);
  let active = null;
  let nextPiece = bagRandom();
  let holdPiece = null;
  let holdUsed = false;

  let score = 0, level = 1, lines = 0;
  let dropInterval = 750;
  let lastDrop = 0;
  let paused = true;
  let dead = false;

  function createGrid(cols, rows){
    return Array.from({length:rows}, () => Array(cols).fill(null));
  }

  // 7-bag randomizer
  function bagRandom(){
    const types = ['I','O','T','S','Z','J','L'];
    if (!bagRandom.bag || bagRandom.bag.length === 0) {
      bagRandom.bag = shuffle([...types]);
    }
    return { type: bagRandom.bag.pop(), rot:0, x:3, y:-2 };
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function getCells(p){
    const shape = SHAPES[p.type][p.rot];
    return shape.map(([dx,dy]) => ({ x: p.x + dx, y: p.y + dy }));
  }
  function valid(p){
    const cells = getCells(p);
    for(const c of cells){
      if (c.x < 0 || c.x >= COLS || c.y >= ROWS) return false;
      if (c.y >= 0 && grid[c.y][c.x]) return false;
    }
    return true;
  }

  function spawn(){
    active = nextPiece;
    active.x = 3; active.y = -2; active.rot = 0;
    nextPiece = bagRandom();
    holdUsed = false;
    if (!valid({...active, y: active.y+1})) {
      dead = true;
      gameOver();
    }
    renderHUDMini();
    draw();
  }

  function lock(p){
    const cells = getCells(p);
    for (const c of cells){
      if (c.y < 0){ dead = true; break; }
      grid[c.y][c.x] = p.type;
    }
    clearLines();
  }

  function clearLines(){
    let cleared = 0;
    for (let y=ROWS-1; y>=0; y--){
      if (grid[y].every(v => v !== null)){
        grid.splice(y,1);
        grid.unshift(Array(COLS).fill(null));
        cleared++;
        y++;
      }
    }
    if (cleared){
      lines += cleared;
      score += cleared === 1 ? 100 : cleared === 2 ? 300 : cleared === 3 ? 500 : 800;
      level = 1 + Math.floor(lines/10);
      dropInterval = Math.max(100, 750 - (level-1)*55);
      updateHUD();
    }
  }

  function rotate(){
    if (!active || paused || dead) return;
    const newRot = (active.rot + 1) % 4;
    let cand = {...active, rot:newRot};
    // naive wall-kick attempts
    const kicks = [ {x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:-2,y:0},{x:2,y:0} ];
    for (const k of kicks){
      const tryP = {...cand, x:active.x+k.x, y:active.y+k.y};
      if (valid(tryP)){ active = tryP; draw(); return; }
    }
  }

  function move(dx){
    if (!active || paused || dead) return;
    const cand = {...active, x: active.x + dx};
    if (valid(cand)) { active = cand; draw(); }
  }

  function softDrop(){
    if (!active || paused || dead) return;
    const cand = {...active, y: active.y + 1};
    if (valid(cand)) {
      active = cand;
      score += 1; updateHUD();
    } else {
      lock(active);
      if (dead){ gameOver(); return; }
      spawn();
    }
    draw();
  }

  function hardDrop(){
    if (!active || paused || dead) return;
    let steps = 0;
    while (valid({...active, y: active.y + 1})) { active.y++; steps++; }
    score += steps * 2; updateHUD();
    lock(active);
    if (dead){ gameOver(); return; }
    spawn();
    draw();
  }

  function hold(){
    if (!active || paused || dead || holdUsed) return;
    const temp = holdPiece ? { ...holdPiece } : null;
    holdPiece = { type: active.type, rot:0 };
    holdUsed = true;
    if (temp){
      active = { type: temp.type, rot:0, x:3, y:-2 };
      if (!valid({...active, y: active.y+1})) { dead=true; gameOver(); return; }
    } else {
      spawn();
    }
    renderHUDMini();
    draw();
  }

  function ghostCells(){
    if (!active) return [];
    let ghost = {...active};
    while (valid({...ghost, y: ghost.y+1})) ghost.y++;
    return getCells(ghost).filter(c=>c.y>=0);
  }

  function updateHUD(){
    scoreEl.textContent = String(score);
    levelEl.textContent = String(level);
    linesEl.textContent = String(lines);
  }

  function clearBoardVisual(){
    boardEl.querySelectorAll('.cell, .ghost').forEach(n=>n.remove());
  }

  function drawCell(x,y,type,cls='cell'){
    const el = document.createElement('div');
    el.className = `${cls} ${COLORS[type]||'c-I'}`;
    const bw = boardEl.clientWidth;
    const bh = boardEl.clientHeight;
    const cw = bw / COLS;
    const ch = bh / ROWS;
    el.style.width = `${cw-2}px`;
    el.style.height = `${ch-2}px`;
    el.style.left = `${x*cw+1}px`;
    el.style.top = `${y*ch+1}px`;
    boardEl.appendChild(el);
  }

  function draw(){
    clearBoardVisual();
    // draw locked grid
    for (let y=0;y<ROWS;y++){
      for (let x=0;x<COLS;x++){
        const t = grid[y][x];
        if (t) drawCell(x,y,t,'cell');
      }
    }
    // ghost
    const g = ghostCells();
    for (const c of g){ drawCell(c.x,c.y,active.type,'ghost'); }
    // active
    if (active){
      for (const c of getCells(active)){
        if (c.y>=0) drawCell(c.x,c.y,active.type,'cell');
      }
    }
  }

  function renderHUDMini(){
    // Hold
    holdWrap.innerHTML = '';
    holdName.textContent = holdPiece ? holdPiece.type : '—';
    if (holdPiece){
      renderMini(holdWrap, holdPiece.type);
    }
    // Next
    nextWrap.innerHTML = '';
    nextName.textContent = nextPiece.type;
    renderMini(nextWrap, nextPiece.type);
  }

  function renderMini(container, type){
    const preview = document.createElement('div');
    preview.style.position='relative'; preview.style.width='100%'; preview.style.height='100%';
    container.appendChild(preview);
    const shape = SHAPES[type][0];
    const maxY = Math.max(...shape.map(([x,y])=>y));
    const cw = container.clientWidth / 4;
    const ch = container.clientHeight / Math.max(3, maxY+1);
    shape.forEach(([x,y])=>{
      const d = document.createElement('div');
      d.className = `cell ${COLORS[type]}`;
      d.style.position='absolute';
      d.style.width = `${cw-3}px`; d.style.height = `${ch-3}px`;
      d.style.left = `${x*cw+1}px`; d.style.top = `${y*ch+1}px`;
      preview.appendChild(d);
    });
  }

  function gameOver(){
    paused = true;
    finalScoreEl.textContent = String(score);
    bannerEl.classList.add('show');
  }
  function hideBanner(){ bannerEl.classList.remove('show'); }

  function reset(){
    grid = createGrid(COLS, ROWS);
    active = null;
    nextPiece = bagRandom();
    holdPiece = null; holdUsed = false;
    score = 0; level = 1; lines = 0;
    dropInterval = 750; lastDrop = 0;
    paused = true; dead = false;
    updateHUD(); renderHUDMini(); hideBanner();
    clearBoardVisual();
  }

  function loop(ts){
    if (paused || dead){ requestAnimationFrame(loop); return; }
    if (!lastDrop) lastDrop = ts;
    const delta = ts - lastDrop;
    if (delta >= dropInterval){ softDrop(); lastDrop = ts; }
    requestAnimationFrame(loop);
  }

  // Events
  btnLeft.addEventListener('click', ()=> move(-1));
  btnRight.addEventListener('click', ()=> move(1));
  btnDown.addEventListener('click', ()=> softDrop());
  btnRotate.addEventListener('click', ()=> rotate());
  btnHard.addEventListener('click', ()=> hardDrop());

  btnStart.addEventListener('click', ()=> { if (dead) reset(); paused=false; if (!active) spawn(); });
  btnPause.addEventListener('click', ()=> { paused=true; });
  btnRestart.addEventListener('click', ()=> { reset(); paused=false; spawn(); });
  btnCloseBanner.addEventListener('click', hideBanner);

  ctaPlay.addEventListener('click', ()=> { paused=false; if (!active) spawn(); });
  ctaMenu.addEventListener('click', ()=> sheet.classList.add('open'));
  closeSheet.addEventListener('click', ()=> sheet.classList.remove('open'));
  sheetPlay.addEventListener('click', ()=> { paused=false; if (!active) spawn(); sheet.classList.remove('open'); });
  sheetStart.addEventListener('click', ()=> { paused=false; if (!active) spawn(); sheet.classList.remove('open'); });
  sheetPause.addEventListener('click', ()=> { paused=true; });
  sheetReset.addEventListener('click', ()=> { reset(); });

  // Keyboard (WASD)
  window.addEventListener('keydown', (e)=>{
    if (e.key === 'a' || e.key === 'A') move(-1);
    else if (e.key === 'd' || e.key === 'D') move(1);
    else if (e.key === 's' || e.key === 'S') softDrop();
    else if (e.key === 'w' || e.key === 'W') rotate();
    else if (e.key === ' ') hardDrop();
    else if (e.key.toLowerCase() === 'c') hold(); // hold
    else if (e.key.toLowerCase() === 'p') paused = !paused;
  });

  // Resize redraw
  window.addEventListener('resize', draw);

  // Init
  reset();
  requestAnimationFrame(loop);

  // Long-press down to accelerate
  let holdInterval = null;
  btnDown.addEventListener('pointerdown', ()=>{
    softDrop();
    clearInterval(holdInterval);
    holdInterval = setInterval(softDrop, 100);
  });
  ['pointerup','pointerleave','pointercancel'].forEach(ev=>{
    btnDown.addEventListener(ev, ()=> clearInterval(holdInterval));
  });

})();
</script>
</body>
</html>